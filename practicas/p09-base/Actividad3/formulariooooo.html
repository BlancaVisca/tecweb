<?php
// Verificar si se recibió el parámetro "id"
if (isset($_GET['id'])) {
    $id_producto = intval($_GET['id']); // Convertir a entero para evitar SQL Injection
    $producto = [];

    // Conectar a la base de datos
    @$link = new mysqli('localhost', 'root', 'blancaflor', 'marketzone');

    // Comprobar conexión
    if ($link->connect_errno) {
        die('<p style="color: red; text-align: center;">Error en la conexión: ' . htmlspecialchars($link->connect_error) . '</p>');
    }

    // Consultar el producto por ID
    if ($result = $link->query("SELECT * FROM productos WHERE id = $id_producto AND eliminado = 0")) {
        $producto = $result->fetch_assoc();
        $result->free();
    }
    $link->close();

    // Verificar si el producto existe
    if (empty($producto)) {
        die('<p style="color: red; text-align: center;">Producto no encontrado...</p>');
    }
} else {
    $producto = [
        'nombre' => '',
        'marca' => '',
        'modelo' => '',
        'precio' => '',
        'detalles' => '',
        'unidades' => '',
        'img' => ''
    ];
}
?>

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Registro de Productos</title>
    <style type="text/css">
        ol, ul {
            list-style-type: none;
        }
    </style>
</head>

<body>
    <h1>Registro de Productos</h1>

    <p>Ingresa los productos nuevos al inventario</p>

    <form id="formularioProductos" action="http://localhost/tecweb/practicas/p08-base/set_producto_v2.php" method="post">

        <h2>Información del Producto a Registrar</h2>

        <fieldset>
            <legend>Información Del Producto</legend>

            <ul>
                <li><label for="form-nombre">Nombre:</label>
                    <input type="text" name="nombre" id="form-nombre" value="<?= htmlspecialchars($producto['nombre']) ?>">
                    <div id="res1" style="color: red;"></div>
                </li><br>

                <li>
                    <label for="form-marca">Marca del producto:</label>
                    <select name="marca" id="form-marca">
                        <option value="">Seleccione una marca</option>
                        <option value="Rolex" <?= ($producto['marca'] == 'Rolex') ? 'selected' : '' ?>>Rolex</option>
                        <option value="Omega" <?= ($producto['marca'] == 'Omega') ? 'selected' : '' ?>>Omega</option>
                        <option value="Tag Heuer" <?= ($producto['marca'] == 'Tag Heuer') ? 'selected' : '' ?>>Tag Heuer</option>
                        <option value="Patek Philippe" <?= ($producto['marca'] == 'Patek Philippe') ? 'selected' : '' ?>>Patek Philippe</option>
                        <option value="Seiko" <?= ($producto['marca'] == 'Seiko') ? 'selected' : '' ?>>Seiko</option>
                    </select>
                    <div id="res2" style="color: red;"></div>
                </li>

                <li><label for="form-modelo">Modelo:</label>
                    <input type="text" name="modelo" id="form-modelo" value="<?= htmlspecialchars($producto['modelo']) ?>">
                    <div id="res3" style="color: red;"></div>
                </li><br>

                <li><label for="form-precio">Precio:</label>
                    <input type="number" step="0.01" name="precio" id="form-precio" value="<?= htmlspecialchars($producto['precio']) ?>">
                    <div id="res4" style="color: red;"></div>
                </li><br>

                <li><label for="form-detalles">Detalles:</label>
                    <input type="text" name="detalles" id="form-detalles" value="<?= htmlspecialchars($producto['detalles']) ?>">
                    <div id="res5" style="color: red;"></div>
                </li><br>

                <li><label for="form-unidades">Unidades:</label>
                    <input type="number" name="unidades" id="form-unidades" value="<?= htmlspecialchars($producto['unidades']) ?>">
                    <div id="res6" style="color: red;"></div>
                </li><br>

                <li><label for="form-img">Imagen-URL:</label>
                    <input type="text" name="img" id="form-img" value="<?= htmlspecialchars($producto['img']) ?>">
                    <div id="res7" style="color: red;"></div>
                </li><br>

            </ul>
        </fieldset>

        <p>
            <input type="submit" value="Registrar">
            <input type="reset">
        </p>

    </form>
    <script src="./validación.js"></script>
</body>

</html>
